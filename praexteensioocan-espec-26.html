
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>-</title>
    <style>
        html,
        body {
            width: 100% !important;
            height: 100% !important;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 100%);
            color: white;
            overflow: hidden;
        }

        :root {
            --color-primary: #51E0C0;
            --color-secondary: #2a2a4a;
            --color-danger: #ff4757;
        }

        /* Estilos para mensajes */
        .message-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, # 0%, # 100%);
            z-index: 1000;
        }

        .message-box {
            background: #333;
            border: 2px solid gold;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: gold ;
        }

        .message-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #FFFFFF;
        }

        .message-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #e0e0e0;
        }

        .install-button {
            background:  #0f0;
            color: #000;
            border: none;
            padding: 20px 22px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px #7C7C7C;
        }

        .install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px #7C7C7C;
        }

        .retry-button {
           background:  #0f0;
            color: #000;
            border: none;
            padding: 20px 22px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px #7C7C7C;
        }

        .retry-button:hover {
               transform: translateY(-2px);
            box-shadow: 0 8px 30px #7C7C7C;
        }


      .loading-spinner {
  animation: rotate 1s infinite;  
  height: 50px;
  width: 50px;
}

.loading-spinner:before,
.loading-spinner:after {   
  border-radius: 50%;
  content: '';
  display: block;
  height: 20px;  
  width: 20px;
}
.loading-spinner:before {
  animation: ball1 1s infinite;  
  background-color: #cb2025;
  box-shadow: 30px 0 0 #f8b334;
  margin-bottom: 10px;
}
.loading-spinner:after {
  animation: ball2 1s infinite; 
  background-color: #00a096;
  box-shadow: 30px 0 0 #97bf0d;
}

@keyframes rotate {
  0% { 
    -webkit-transform: rotate(0deg) scale(0.8); 
    -moz-transform: rotate(0deg) scale(0.8);
  }
  50% { 
    -webkit-transform: rotate(360deg) scale(1.2); 
    -moz-transform: rotate(360deg) scale(1.2);
  }
  100% { 
    -webkit-transform: rotate(720deg) scale(0.8); 
    -moz-transform: rotate(720deg) scale(0.8);
  }
}

@keyframes ball1 {
  0% {
    box-shadow: 30px 0 0 #f8b334;
  }
  50% {
    box-shadow: 0 0 0 #f8b334;
    margin-bottom: 0;
    -webkit-transform: translate(15px,15px);
    -moz-transform: translate(15px, 15px);
  }
  100% {
    box-shadow: 30px 0 0 #f8b334;
    margin-bottom: 10px;
  }
}

@keyframes ball2 {
  0% {
    box-shadow: 30px 0 0 #97bf0d;
  }
  50% {
    box-shadow: 0 0 0 #97bf0d;
    margin-top: -20px;
    -webkit-transform: translate(15px,15px);
    -moz-transform: translate(15px, 15px);
  }
  100% {
    box-shadow: 30px 0 0 #97bf0d;
    margin-top: 0;
  }
}
      
      
      
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none !important;
        }

        #player {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .extension-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: black;
        }

        .error-box .message-icon {
            color: var(--color-danger);
        }

        .error-box .message-title {
            color: var(--color-danger);
        }

        .error-box {
            border-color: var(--color-danger);
        }
      
        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .hidden {
            display: none;
        }
.alert-card {
            background-color: #333;
            border-radius: 8px;
            padding: 20px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
        }

        .alert-card h2 {
            margin-top: 0;
            font-size: 24px;
        }

        .alert-card .boxicon {
            font-size: 48px;
            color: #000;
        }

        .alert-card p {
            margin: 10px 0;
            color: #000;
        }

        @media (max-width: 480px) {
            .alert-card {
                max-width: 90%;
                padding: 5px;
                /* margin-right: 50px; */
            }

            .alert-card h2 {
                font-size: 20px;
            }

            .alert-card .boxicon {
                font-size: 36px;
            }

            .alert-card p {
                font-size: 14px;
            }
        }

        @media (max-width: 768px) {
            .alert-card {
                max-width: 80%;
                padding: 25px;
            }

            .alert-card h2 {
                font-size: 22px;
            }

            .alert-card .boxicon {
                font-size: 42px;
            }

            .alert-card p {
                font-size: 16px;
            }
        }

        a {
            color: #000!important;
            text-decoration: underline;
        }

        .jw-featured,
        .jw-rightclick {
            display: none !important;
        }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
<link rel="stylesheet" href="https://boxicons.com/css/boxicons.min.css">
  <script>
  let channelList = [
    {
        name: '',
        getURL: '',
        keyId: "",
        key: "",
        number: 0,
    }
]



function getChannelNumber(getURL) {
    if (getURL == "QTNfQ2luZQ==" || getURL == "Q2FuYWxfUFJP" || getURL == "VW5pdmVyc28=" || getURL == "Q2FuYWxfMTFfUGFyYW5h" || getURL == "Q0FOQUxfTFVa" || getURL == "QWxsZWdyb0hE" || getURL == "QmFieVRW" || getURL == "RE5ld3M=" || getURL == "VVNBX05ldHdvcms=" || getURL == "QTNfU2VyaWVz" || getURL == "TWVnYV9UVg==" || getURL == "QW1lcmljYV9UdWN1bWFu" || getURL == "UFhfU3BvcnRz" || getURL == "Q2gxMF9UdWN1bWFu" || getURL == "SG9tZV9hbmRfR2FyZGVu" || getURL == "REhF" || getURL == "Rmxvd19NdXNpY19YUA==" || getURL == "QUVIRA==" || getURL == "SG9sYV9UVg==" || getURL == "QVhOSEQ=" || getURL == "TVRWMDA=" || getURL == "V2FybmVySEQ=" || getURL == "R0VOX1RW" || getURL == "Rm94X1Nwb3J0c19QcmVtaXVuX0hE" || getURL == "VG9kb05vdGljaWFz" || getURL == "VHlDU3BvcnQ" || getURL == "QW1lcmljYTI0" || getURL == "QzVO" || getURL == "TGFfTmFjaW9u" || getURL == "Q3JvbmljYVRW" || getURL == "Q2FuYWxfOF9UdWN1bWFu" || getURL == "UGFyYWd1YXlfVFY=" || getURL == "UGFyYW1vdW50" || getURL == "Q29tZWR5Q2VudHJhbA" || getURL == "Rmxvd19NdXNpY19YUA==" || getURL == "Rmxvd19NdXNpY18x" || getURL == "Rmxvd19NdXNpY18y" || getURL == "Rmxvd19NdXNpY18z" || getURL == "Qm9vbWVyYW5n" || getURL == "RHJlYW13b3Jrcw==" || getURL == "QW5pbWFsUGxhbmV0" || getURL == "SGlzdG9yeUhE" || getURL == "SUQ=" || getURL == "QnJhdm9UVg==" || getURL == "U29ueUhE" || getURL == "U29ueV9Nb3ZpZXM=" || getURL == "VHJ1VFY=" || getURL == "SEJPX1BPUA==" || getURL == "RGlzY292ZXJ5VHVyYm8=" || getURL == "RGlzbmV5SnI=" || getURL == "SW52ZXN0aWdhY2lvbl9QZXJpb2Rpc3RpY2E=" || getURL == "Rm94U3BvcnRzMl9VWQ==" || getURL == "RVNQTjQ=" || getURL == "Rm94U3BvcnRzM19VWQ==" || getURL == "RXZlbnRvc19IRF9VeQ==" || getURL == "VGVsZW11bmRvX0hE" || getURL == "UGFzaW9uZXM=") {
        return 7;
    } else if (getURL == "RVNQTjJfQXJn" || getURL == "Q2FuYWxfMjE=" || getURL == "VGVsZW5vdmVsYXM=" || getURL == "RVdUTg==" || getURL == "S1pP" || getURL == "Vm9ydGVyaXg=" || getURL == "RFc=" || getURL == "Q05OX0ludGVybmFjaW9uYWw=" || getURL == "S2lkb28=" || getURL == "VG9vbmNhc3Q=" || getURL == "UGxpbV9QbGlt" || getURL == "RnJhbmNlXzI0" || getURL == "Tmlja211c2lj" || getURL == "U29tb3NfTGFfUGxhdGE=" || getURL == "QXJ0ZWFyX0ludGVybmFjaW9uYWw=" || getURL == "RXZlbnRvc18yX0hE" || getURL == "R29sZGVu" || getURL == "Q2FuYWxfOV9QYXJhbmE=" || getURL == "R29sZl9DaGFubmVs" || getURL == "Q2FuYWxfYQ==" || getURL == "QW1lcmljYV9TcG9ydHM=" || getURL == "Q2luZW1heA==" || getURL == "RXZlbnRvc18yX0hE" || getURL == "Q2FuYWxfOF9DQkE" || getURL == "MjZfVFZfSEQ" || getURL == "RGlwdXRhZG9zX1RW" || getURL == "QXJnZW50aW5pc2ltYQ" || getURL == "TWV0cm8" || getURL == "QkJDX1dvcmxkX05ld3M" || getURL == "VGhlYXRlcl9IRA==" || getURL == "R2xpdHo=" || getURL == "UXVpZXJvX0hE" || getURL == "RGlzY292ZXJ5X1dvcmxkX0hE" || getURL == "RXVyb2NoYW5uZWw=" || getURL == "RGlzY292ZXJ5X1NjaWVuY2U=" || getURL == "SU5DQUFfVHY=" || getURL == "VFY1X01vbmRl" || getURL == "TVRWX0hpdHM=" || getURL == "TVRWX0hE" || getURL == "Tmlja19Kcg==" || getURL == "VFZfRXNwYW5h" || getURL == "V09CSQ==" || getURL == "Vm9sdmVy" || getURL == "VGVsZXN1cg==" || getURL == "TGlmZXRpbWU=" || getURL == "QW50ZW5hXzM=" || getURL == "Rm94X05ld3M=" || getURL == "VHZfQ2hpbGU=" || getURL == "TWFzX0NoaWM=" || getURL == "U3R1ZGlvX1VuaXZlcnNhbA==" || getURL == "SVNBVA==" || getURL == "U3VuX0NoYW5uZWw=" || getURL == "UkFJ" || getURL == "VmVudXM=" || getURL == "U2V4dHJlbWU" || getURL == "UGxheWJveQ" || getURL == "VE5UX1Nwb3J0c19IRA" || getURL == "VGVsZWZlSEQ=" || getURL == "Q2FuYWw3" || getURL == "RW5jdWVudHJv" || getURL == "VGVsZW1heA" || getURL == "TmV0X1RW" || getURL == "Q2FuYWxfMTJfQ0JB" || getURL == "RWxfR2FyYWdl" || getURL == "RmlsbV9BcnRz" || getURL == "VW5pdmVyc2FsX0NoYW5uZWxfSEQ=" || getURL == "RXVyb3BhX0V1cm9wYQ" || getURL == "RXVyb25ld3M=" || getURL == "Rm9vZF9OZXR3b3Jr" || getURL == "RV9FbnRlcnRhaW5tZW50X1RlbGV2aXNpb24=" || getURL == "Q00=" || getURL == "UEFLQV9QQUtB" || getURL == "SGlzdG9yeV8y" || getURL == "U3lGeQ==" || getURL == "VEJT" || getURL == "VENN" || getURL == "SEJPXzI=" || getURL == "SEJPX1BsdXM=" || getURL == "SEJPX0ZhbWlseQ==" || getURL == "SEJPX0V4dHJlbWU=" || getURL == "SEJPX011bmRp" || getURL == "SEJPX1NpZ25hdHVyZQ==" || getURL == "Q2FuYWxfUnVyYWw=" || getURL == "VExD" || getURL == "Q2FuYWxfZGVfbGFfY2l1ZGFk" || getURL == "RGlzY292ZXJ5X0tpZHM=" || getURL == "SFRW" || getURL == "TkJBX1RW" || getURL == "VW5pdmVyc2FsX0NpbmVtYQ==" || getURL == "VW5pdmVyc2FsX0NvbWVkeQ==" || getURL == "dW5pdmVyc2FsX0NyaW1l" || getURL == "VW5pdmVyc2FsX1ByZW1pZXJl" || getURL == "VW5pdmVyc2FsX1JlYWxpdHk=" || getURL == "Q05OX2VuX0VzcGFub2w=" || getURL == "aameser1py" || getURL == "Q2FuYWxfZGVfbGFzX2VzdHJlbGxhcw==") {
        return 6;
    } else if (getURL == "QzlOX0M0" || getURL == "Q2FuYWxfQw==" || getURL == "U29tb3NfUm9zYXJpbw==" || getURL == "U29tb3NfU1RG" || getURL == "QUJDX1RWX0M0") {
        return 5;
    } else if (getURL == "RGlzY292ZXJ5SG9tZUhlYWx0aEhE" || getURL == "Qmxvb21iZXJn" || getURL == "Q2FuYWxfVQ==" || getURL == "RnJhbmNlMjRfRmxvdw==" || getURL == "VFZfTmFjaW9uYWxfVXk=" || getURL == "UmVkZV9SZWNvcmQ=" || getURL == "U29tb3NfQmFoaWFfQmxhbmNh" || getURL == "Q2FuYWxfM19Sb3Nhcmlv" || getURL == "Q2FuYWw3X0JhaGlhX0JsYW5jYQ==" || getURL == "Q2FuYWxfMTNfU0ZF" || getURL == "Q2FuYWw5X0JhaGlhX0JsYW5jYQ==" || getURL == "TmF0R2VvSEQ=" || getURL == "VE5UX0hEX0FyZw==" || getURL == "VE5UU2VyaWVz" || getURL == "Q2FydG9vbk5ldHdvcms=" || getURL == "Tmlja2Vsb2Rlb24=" || getURL == "QWR1bHRfU3dpbQ==" || getURL == "RXZlbnRvczFIRA") {
        return 3;
    } else if (getURL == "Q2FuYWxfNV9Sb3Nhcmlv" || getURL == "VFZfQ2FtYXJh" || getURL == "Q0hfMTJfUG9zYWRhcw==" || getURL == "Q0JBMjQ=" || getURL == "TWl4VFY=" || getURL == "TG9jYWxfQ2FybG9zX1Bheg==" || getURL == "Q2FuYWwxMF9DQkFfSEQ=" || getURL == "VU5JQ0FOQUxfQzQ=" || getURL == "TGF0YW1fUnVyYWw=" || getURL == "U29tb3NfQ29ycmllbnRlcw==" || getURL == "U29tb3NfU2FsdGE=" || getURL == "U29tb3NfUmFmYWVsYQ==" || getURL == "U29tb3NfUmVzaXN0ZW5jaWE=" || getURL == "U29tb3NfRWxfVmFsbGU=" || getURL == "Q2FuYWxfQ2l1ZGFkX01EUQ==" || getURL == "NV9EaWFzX1BZ" || getURL == "VGVsZWZlX0ludGVybmFjaW9uYWw=" || getURL == "Q0hfMTNfQ29ycmllbnRlcw==" || getURL == "U2hvd19TcG9ydHM=" || getURL == "Q0hfOV9SZXNpc3RlbmNpYQ==" || getURL == "VEVMRUZVVFVST19DNA==" || getURL == "VGVsZWZlX05ldXF1ZW4=" || getURL == "U05UX0M0" || getURL == "UEFSQVZJU0lPTl9DNA==" || getURL == "Tk9USUNJQVNfUFlfQzQ=" || getURL == "Tk9USUNJQVNfUFlfQzQ=" || getURL == "UEFSQVZJU0lPTl9DNA==" || getURL == "TEFfVEVMRV9DNA==" || getURL == "U1VSX1RWX0M0" || getURL == "Q2FuYWwxMlVSVQ==" || getURL == "RGlzY292ZXJ5SG9tZUhlYWx0aEhE" || getURL == "Q2FuYWw0X1VSVQ==" || getURL == "SEJPSEQ=" || getURL == "Q2FuYWwxMF9VUlU=" || getURL == "UlBDX0M0") {
        return 4;
    } else {
        return 3;
    }
}

function getChannelKeys(getURL) {
    const channelMap = {
        "Q2FuYWxfUFJP": { keyId: "8df0f1a1e05e9c6a438e23a87c9d06ea", key: "5df74d374a2a8a871463e7c438fa3ba7" }, //Canal_PRO
        "aameser1py": { keyId:  "10d3d4f33a6bad277accc2688c46b406", key: "588fd56bcab1fcdb4f33b5c2f7018d29" }, //AMCseries
        
        "Q2FuYWxfZGVfbGFfY2l1ZGFk": { keyId: "5ee7842b3cf24d1dba088365fa5d0543", key: "69cec006409823c06fbf2866a231b4f7" } // El Canal de la Ciudad
    };

    channelList[0].name = atob(getURL);
    channelList[0].getURL = getURL;
    channelList[0].number = getChannelNumber(getURL);
    channelList[0].keyId = channelMap[getURL].keyId;
    channelList[0].key = channelMap[getURL].key;


    // return channelMap[getURL] || { keyId: null, key: null };
    return channelList;
}


function getParameterByName(name) {
    name = name.replace(/[\[]/, "\[").replace(/[\]]/, "\]");
    var regex = new RegExp("[\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

// var getURL = getParameterByName('get');
// channelList = getChannelKeys(getURL);




async function getURLwithToken() {
    let token = sessionStorage.getItem('token')
    if (!token) {
        const url = 'https://chromecast.cvattv.com.ar/live/c7eds/La_Nacion/SA_Live_dash_enc_wl/La_Nacion.m3u8';
        let response = await fetch(url, { signal: AbortSignal.timeout(5000) });
        if (response.redirected) {
            const regex = /(https:\/\/.+?)(?=\/live)/;
            const match = response.url.match(regex);
            if (match) {
                token = match[0]
                sessionStorage.setItem('token', match[0])
            }
        }
    }
    return token
}


// Dominios
let mt = [
    "chromecast",
    "cdn",
    "edge-live01-cte",
    "edge-live02-mun",
    "edge-mix02-cte",
    "edge-mix04-coe",
    "edge-mix05-coe",
    "edge2-ccast-sl",

    //No funciona
    // "edge1-ccast-sl",
    // "edge-live01-mun",
    // "edge-live11-hr",
    // "edge-live12-hr",
    // "edge-live13-hr",
    // "edge-live14-hr",
    // "edge-live15-hr",
    // "edge-live16-hr",
    // "edge-live17-hr",
    // "edge-live31-hr",
    // "edge-live32-hr",
    // "edge-live34-hr",
    // "edge-live11-sl",
    // "edge-live12-sl",
    // "edge-live13-sl",
    // "edge-live15-sl",
    // "edge-live17-sl",
    // "edge-live31-sl",
    // "edge-vod02-sl",
    // "edge-vod04-sl",
    // "edge-vod06-sl",
    // "edge9-sl",
    // "edge10-sl",
    // "edge-live14-sl",
    // "edge-vod01-hr",
    // "edge-vod03-hr",
    // "edge-vod04-hr",
    // "edge6-ccast-sl",
    // "edge-live01-cen",
    // "edge-live03-cen",
    // "edge-vod01-cen",
    // "edge-live01-coe",
    // "edge-mix01-coe",
    // "edge-mix02-coe",
    // "edge-mix03-coe",
    // "edge-mix01-ird",
    // "edge-mix02-ird",
    // "edge-mix01-mus",
    // "edge-mix03-mus",
]

// Comprueba dominios y lo asigna
let mt2 = [...mt];
async function getValidMpd(channelInfo) {
    const channelToLoad = channelInfo || channelList[0];
    currentChannel = channelToLoad;
    if (channelToLoad.type == 'external') return channelToLoad.getURL
    let getMPDTries = 0
    // while (mt2.length > 0) {
    while (getMPDTries < 5) {
        getMPDTries++
        let urlWithToken = await getURLwithToken()
        let url = `${urlWithToken}/live/c6eds/AMC_Series/SA_Live_dash_enc/AMC_Series.mpd`;

        async function readStream(streamMPD) {
            return streamMPD.read().then(({ value }) => {
                const decoder = new TextDecoder();
                const mpdProcessed = decoder.decode(value, { stream: true });
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(mpdProcessed, 'application/xml');
                const adaptationSets = xmlDoc.getElementsByTagName('AdaptationSet');
                const repId = adaptationSets[1].getElementsByTagName('Representation')[0].getAttribute('id')
                const baseURL = adaptationSets[1].getElementsByTagName('SegmentTemplate')[0].getAttribute('initialization')
                const segmentUrl = baseURL.replace('$RepresentationID$', repId);
                return segmentUrl
            }).catch(error => {
                console.error('Error reading mpd:', error);
            });
        }

        try {
            let response = await fetch(url, { signal: AbortSignal.timeout(5000) }); // Cancel at 5s if response timeout
            if (!response.ok || response.status !== 200) throw new Error('MPD token caido')
            const mpd_MP4 = await readStream(response.body.getReader())
            const mpd_MP4_url = `${response.url.slice(0, response.url.indexOf('SA_Live_dash_enc') + 17)}${mpd_MP4}`
            let MP4_response = await fetch(mpd_MP4_url)
            if (MP4_response.ok) {
                getMPDTries = 0
                audioChanged = false
                return url
            } else {
                console.log(`Link caido. Error: ${MP4_response.status}. Reintentando... (${getMPDTries})`);
                throw new Error('MPD Caido')
            }
        } catch (error) {
            console.log("Error fetching URL:", error);
        }


    }
    mt2 = [...mt]
    const errorMsg = document.querySelector('.homeScreen #appError'); errorMsg && (errorMsg.style.display = 'block');
    const animLoader = document.querySelector('.homeScreen .loader'); animLoader && (animLoader.style.display = 'none');
    
}

  </script>
  
  
  
</head>

<body>
    <!-- Mensaje de carga -->
    <div id="loading-message" class="message-container">
        <div class="">
            <div class="loading-spinner"></div>
            <div class="message-title"></div>
            <div class="message-text"></div>
        </div>
    </div>

    <!-- Mensaje de extensión faltante -->
    <div id="alerta-extension" class="message-container hidden">
        <div class="message-box">
            <div class="message-icon"> <i class="bx bx-error-circle boxicon"></i></div>
            <div class="message-title">Instalar Extensión VideoPlayer</div>
            <div class="message-text">Para ver los canales, necesitas añadir la extensión VideoPlayer.<br>
               Es un reproductor nativo para videos.<br>

Una vez instalada la extensión en tu Navegador,<br> recargar esta página.
                <br>
               Recuerda:La Opción FL estan disponibles en Argentina, Paraguay, Uruguay,<br>
             sino estas en estos paises usar VPN conectado estos Paises
            </div>
            <a href="https://chromewebstore.google.com/detail/videoplayer-mpdm3u8m3uepg/opmeopcambhfimffbomjgemehjkbbmji"
                class="install-button" target="_blank">
                Instalar Extensión
            </a>
         
        </div>
    </div>

    <!-- Reproductor -->
    <div id="player" class="hidden"></div>

    <script>
        const STREAM_URL = "chrome-extension://opmeopcambhfimffbomjgemehjkbbmji/pages/player.html#https://localhost/?headers=eyJPcmlnaW4iOiAiaHR0cHM6Ly9wb3J0YWwuYXBwLmZsb3cuY29tLmFyIiwgIlJlZmVyZXIiOiJodHRwczovL3BvcnRhbC5hcHAuZmxvdy5jb20uYXIifQ==";

        let currentChannel;
        let mpdBase;
        let iframeAdded = false;

        // Función para mostrar/ocultar elementos
        function showElement(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideElement(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function hideAllMessages() {
            hideElement('loading-message');
            hideElement('alerta-extension');
        }

        // Función para obtener parámetros de URL
        function getParameterByName(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Función para verificar si la extensión está instalada
        function isExtensionInstalled(installedCallback, notInstalledCallback) {
            const img = document.createElement('img');
            img.onload = installedCallback;
            img.onerror = notInstalledCallback;
            img.src = 'chrome-extension://opmeopcambhfimffbomjgemehjkbbmji/play-on.png';
        }

        // Función para agregar el iframe al reproductor cuando hay error
        function addIframeToPlayer() {
            if (!iframeAdded) {
                console.log("Agregando iframe de respaldo al reproductor...");

                const playerDiv = document.getElementById('player');

                // Limpiar contenido previo del reproductor
                playerDiv.innerHTML = '';

                // Crear y agregar iframe
                const iframe = document.createElement('iframe');
                iframe.className = 'extension-iframe';
                iframe.src = STREAM_URL;
                iframe.allow = 'encrypted-media *;';
                iframe.frameBorder = '0';

                //  lo ocultamos
                iframe.style.display = "none";

                //  Espera 1 segundo cuando cargue el iframe y reinicia la página
                iframe.onload = () => {
                    console.log("Iframe cargado, reiniciando en 1 segundo...");
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                };

                playerDiv.appendChild(iframe);

                iframeAdded = true;

                // Mostrar el reproductor
                hideAllMessages();
                showElement('player');
            }
        }

        // Función para cargar el canal después del reinicio
        async function loadChannelStream() {
            try {
                console.log("Cargando canal después del reinicio...");

                // Verificar si channelList existe
                if (typeof channelList === 'undefined' || typeof getChannelKeys === 'undefined') {
                    throw new Error('Los archivos de canales no se cargaron correctamente');
                }

                const channels = getChannelKeys(getParameterByName('get'));
                if (!channels || channels.length === 0) {
                    throw new Error('No se encontraron canales válidos');
                }

                currentChannel = channels[0];
                console.log("Canal seleccionado:", currentChannel);

                // Verificar keyId y key
                const keyId = currentChannel.keyId;
                const key = currentChannel.key;

                if (!keyId || !key) {
                    throw new Error('KeyId o Key no definidos en el canal seleccionado');
                }

                // Obtener MPD base
                if (typeof getValidMpd !== 'undefined') {
                    mpdBase = await getValidMpd();
                } else {
                    throw new Error('Función getValidMpd no disponible');
                }

                if (!mpdBase) {
                   
                }

                console.log("MPD obtenido:", mpdBase);

                // Convertir keyId y key a una cadena JSON
                var keyString = `"${keyId}":"${key}"`;
                var base64Key = btoa(keyString);

                console.log("KeyString:", keyString);
                console.log("Base64Key:", base64Key);

                // Construir la URL de la extensión con el header específico
                var extensionUrl = `chrome-extension://opmeopcambhfimffbomjgemehjkbbmji/pages/player.html#${mpdBase}?ck=${encodeURIComponent(base64Key)}&headers=eyJPcmlnaW4iOiAiaHR0cHM6Ly9wb3J0YWwuYXBwLmZsb3cuY29tLmFyIiwgIlJlZmVyZXIiOiJodHRwczovL3BvcnRhbC5hcHAuZmxvdy5jb20uYXIifQ==`;

                console.log("Extension URL:", extensionUrl);

                // Mostrar el reproductor
                const playerDiv = document.getElementById("player");

                isExtensionInstalled(
                    () => {
                        console.log("Extensión detectada, cargando canal...");
                        hideAllMessages();
                        playerDiv.classList.remove("hidden");
                        playerDiv.innerHTML = `<iframe id="iframe" class="extension-iframe" allow="encrypted-media" allowfullscreen src="${extensionUrl}"></iframe>`;
                    },
                    () => {
                        console.log("Extensión no detectada después del reinicio");
                        hideAllMessages();
                        document.getElementById("alerta-extension").classList.remove("hidden");
                    }
                );

            } catch (error) {
                console.error("Error cargando canal:", error);
                hideAllMessages();
                alert(`Error: ${error.message}`);
            }
        }

        // Función principal de inicialización
        function initializePlayer() {
            console.log("Inicializando reproductor...");

            // Verificar si es la segunda carga (después del reload)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('reloaded') === 'false') {
                console.log("Segunda carga detectada, cargando canal...");
                loadChannelStream();
                return;
            }

            // Primera carga - verificar extensión y iniciar servidor
            isExtensionInstalled(
                () => {
                    console.log("Extensión detectada, iniciando servidor...");
                    // Marcar que vamos a recargar
                    const newUrl = window.location.href + (window.location.search ? '&' : '?') + 'reloaded=false';
                    history.replaceState(null, '', newUrl);
                    addIframeToPlayer();
                },
                () => {
                    console.log("Extensión no detectada");
                    hideAllMessages();
                    document.getElementById("alerta-extension").classList.remove("hidden");
                }
            );
        }

        // Inicializar cuando la página esté lista
        document.addEventListener('DOMContentLoaded', function () {
            console.log("Página cargada, inicializando...");

            // Pequeño delay para asegurar que todos los scripts se carguen
            setTimeout(() => {
                initializePlayer();
            }, 100);
        });

        // Manejo de errores globales
        window.addEventListener('error', function (e) {
            console.error('Error global:', e.error);
        });
    </script>
</body>
</html>
